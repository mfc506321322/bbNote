#### 1.什么是CSRF攻击

CSRF 英文全称是 Cross-site request forgery，所以又称为“跨站请求伪造”，是指黑客引诱用户打开黑客的网站，在黑客的网站中，利用用户的登录状态发起的跨站请求。简单来讲，CSRF 攻击就是黑客利用了用户的登录状态，并通过第三方的站点来做一些坏事。

>和 XSS 不同的是，CSRF 攻击不需要将恶意代码注入用户的页面，仅仅是利用服务器的漏洞和用户的登录状态来实施攻击。

#### 2.完成 CSRF 攻击必须要有三个条件：

- 目标站点一定要有 CSRF 漏洞；
- 用户要登录过目标站点，并且在浏览器上保持有该站点的登录状态；
- 需要用户打开一个第三方站点，可以是黑客的站点，也可以是一些论坛；

#### 3.如何防御

1. **SameSite**

   值有Strict、Lax、None

   可以对 Cookie 设置 SameSite 属性。该属性表示 Cookie 不随着跨域请求发送，可以很大程度减少 CSRF 的攻击，但是该属性目前并不是所有浏览器都兼容。

2. 验证请求的来源站点

   因为CSRF 攻击大多来自第三方站点，因此服务器可以禁止来自第三方站点的请求。通过HTTP请求头中的Referer和Origin属性。

   Origing 属性包含了域名信息，并没包含具体的URL路径，这是Origin和Referer的一个主要区别

   > Origin 的值之所以不包含详细路径信息，是有些站点因为安全考虑，不想把源站点的详细路径暴露给服务器。

3. CSRF Token

   第一步：在浏览器向服务器发起请求时，服务器生成一个 CSRF Token。CSRF Token 其实就是服务器生成的字符串，然后将该字符串植入到返回的页面中。

   第二部：在浏览器端如果要发起转账的请求，那么需要带上页面中的 CSRF Token，然后服务器会验证该 Token 是否合法。如果是从第三方站点发出的请求，那么将无法获取到 CSRF Token 的值，所以即使发出了请求，服务器也会因为 CSRF Token 不正确而拒绝请求。

4. 验证码

#### 4.问答

1. 第三方网站是如何拿到cookie的 2.同源策略为什么不能阻止CSRF。
   同源策略并没有完全限制网站不能使用非同源的资源，比如引用第三方script文件，引用第三方CSS文件等，同样的，也没有限制一些跨域写操作，比如表单提交。因此，光靠同源策略不能阻止CSRF。明白了可以在第三方站点成功发送跨域请求这一点之后，浏览器会自动带上请求的那个站点的cookie。

